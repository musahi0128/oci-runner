name: "OCI runner test"
on:
  workflow_dispatch:
env:
    GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
jobs:
  launch_instance:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/musahi0128/oci-runner-docker:main
      credentials:
        username: ${{ github.actor }}
        password: ${{ secrets.github_token }}
    steps:
      - uses: actions/checkout@v4
      - name: Run
        shell: bash
        run: |
          apt update && \
          apt install -yq tmate && \
          gh workflow run launch_instance.yml || echo "Will be handled in the interactive session" && \
          tmate -F
